define("cl-commonjs/dist/1.1.3/bizcommon",["$","clui","$indexeddb","jslet-data","common"],function(e,t,a){a.exports={bizutils:e("cl-commonjs/dist/1.1.3/bizutils"),bizcache:e("cl-commonjs/dist/1.1.3/bizcache"),datasetfactory:e("cl-commonjs/dist/1.1.3/datasetfactory"),userPref:e("cl-commonjs/dist/1.1.3/userpref")}}),define("cl-commonjs/dist/1.1.3/bizutils",["$","clui","$indexeddb","jslet-data","common"],function(require,exports,module){var $=require("$"),Clui=require("clui"),Cache=require("cl-commonjs/dist/1.1.3/bizcache"),Utils=require("common").utils,Biz={createAction:function(e,t){return $.Deferred(function(a){for(var r=t.length-1;r>=0;r--){var o=t[r];$.isFunction(o.func)&&$(document).on(o.evt,o.selector,o.func)}Cache.queryData("auth_permission").done(function(r){if(r)for(var o in t){var n=t[o],i=!1;if(null!=n.actionCode&&""!=n.actionCode){for(var l in r)n.actionCode==r[l].actionCode&&e==r[l].boCode&&(i=!0);i&&$(n.selector).show()}else $(n.selector).show()}a.resolve()})})},checkRuleNo:function(tenantId,boCode,fieldCode,billNo){return $.Deferred(function(dfd){console.log("\u5f00\u59cb\u6821\u9a8c\u5355\u53f7...");var reqData={tenantId:tenantId,boCode:boCode,fieldCode:fieldCode};Utils.ajax({url:"/cl-restapi/sequencerule/findcheckcode.do",data:reqData,successHandler:function(data){var checkCode=data.extraInfo.checkCode;console.log("\u6821\u9a8c\u516c\u5f0f: "+checkCode),checkCode||(console.log("\u672a\u627e\u5230\u6821\u9a8c\u516c\u5f0f!"),dfd.reject()),checkCode.indexOf("=")<0&&(console.log("\u6821\u9a8c\u516c\u5f0f\u9519\u8bef!"),dfd.reject()),billNo.length>26&&(console.log("\u5355\u53f7\u957f\u5ea6\u5927\u4e8e\u9650\u5236!"),dfd.reject());for(var indexObj={a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7,i:8,j:9,k:10,l:11,m:12,n:13,o:14,p:15,q:16,r:17,s:18,t:19,u:20,v:21,w:22,x:23,y:24,z:25},realExp="",realExpValue=0,i=0,len=checkCode.length;len>i;i++){var exp=checkCode.charAt(i),index=indexObj[exp];if(null!=index&&void 0!=index){var value=billNo.charAt(index);checkCode=checkCode.replace(new RegExp(exp,"ig"),value)}}console.log("checkCode = "+checkCode),realExpValue=parseInt(checkCode.split("=")[1]),checkCode=checkCode.substring(0,checkCode.indexOf("=")),console.log("checkCode = "+checkCode);var calcResult=eval(checkCode),result=calcResult==realExpValue?!0:!1;dfd.resolve(result)}})})},limitTextAreaLines:function(e,t,a,r,o){console.log("\u8ba1\u7b97textarea\u884c\u6570"),o=o||500;var n=0,l="",d=e.getFieldValue(t);if(null!=d&&""!=d){var s=d.split("\n");for(i=0;i<s.length;i++)if(""!=s[i]){if(n+=1,n>o){r.call(),a=!0;try{e.setFieldValue(t,l.substring(0,l.length-1))}finally{a=!1}return a}l+=s[i]+"\n"}}return console.log("\u884c\u6570 = "+n),a},printVoucher:function(e,t,a){if(window.CLCef){a=Number(a)||null;var r={simpleCriteria:{orderType:t,isDefault:1,templateId:a}};Utils.ajax({url:"/cl-restapi/printvoucher/findtemplet.do",dataJson:r,successHandler:function(t){var a={},r=t.main[0];if(!r)return void Clui.alert("\u8bf7\u9009\u62e9\u6216\u521b\u5efa\u6253\u5370\u6a21\u677f");var o=r.templetFieldsList;a.fieldDefs=[];for(var n in o){var i={x:o[n].coordinateX,y:o[n].coordinateY,type:o[n].type,dataName:o[n].fieldCode};o[n].width&&o[n].height&&(i.width=o[n].width,i.height=o[n].height),a.fieldDefs.push(i)}a.version=r.interfaceVersion,a.pageWidth=r.pageWidth,a.pageHeight=r.pageHeight,a.isLabel=1==r.isLabel?!0:!1,a.labelDef={rows:r.rows,columns:r.columns,rowSpace:r.rowSpace,columnSpace:r.columnSpace,topMargin:r.topMargin,leftMargin:r.leftMargin,width:r.bWidth,height:r.bHeight};for(var l=0,d=e.length;d>l;l++){var s=e[l];for(var c in s){var u=Object.prototype.toString.call(s[c]);"[object String]"!==u&&"[object Date]"!==u&&"[object Number]"!==u&&(s[c]=""),"[object Date]"===u&&(s[c]=s[c].toLocaleString())}}var f=Utils.stringifyJSON({data:e,template:a});window.CLCef.printVoucher(f)}})}else Clui.alert("\u8bf7\u4f7f\u7528\u8fb0\u6765\u6781\u901f\u6d4f\u89c8\u5668\u5b8c\u6210\u6b64\u529f\u80fd\u3002")},getWeight:function(e){return window.CLCef?void e(window.CLCef.getWeight()):e(0,"\u8bf7\u4f7f\u7528\u8fb0\u6765\u6781\u901f\u6d4f\u89c8\u5668\u5b8c\u6210\u6b64\u529f\u80fd\u3002")},printReport:function(e,t,a,r){if(window.CLCef){t=Number(t)||null;var o={tenantId:t,templateName:a};Utils.ajax({url:"/cl-restapi/report/querytempalte.do",data:o,successHandler:function(t){var a=t.main[0],o={},n=[],i={};o.datasetDefs=[];for(var l in a.tableAndColumsn){var d={},s=a.tableAndColumsn[l];d.datasetName=l,i[l]=Utils.dataset2Array(e[l],s),d.fieldDefs=[];for(var c in s)d.fieldDefs.push({fieldLen:s[c].fieldLength,fieldType:s[c].fieldType,fieldName:s[c].fieldName});o.datasetDefs.push(d),a.masterDataSet!=l&&n.push(l)}if(o.variables=a.userDefinedColums,o.relationDef=[],n.length>0)for(var u=n.length-1;u>=0;u--){var f={};f.masterDataset=a.masterDataSet,f.detailDataset=n[u],o.relationDef.push(f)}else{var f={};f.masterDataset=a.masterDataSet,f.detailDataset="",o.relationDef.push(f)}for(var h in i)o[h]=i[h];var p=Utils.stringifyJSON(o);a.templateXml||Clui.alert("\u672a\u8bbe\u7f6e\u62a5\u8868\u6a21\u677f"),r?window.CLCef.printReport(p,a.templateXml):window.CLCef.previewReport(p,a.templateXml)}})}else Clui.alert("\u8bf7\u4f7f\u7528\u8fb0\u6765\u6781\u901f\u6d4f\u89c8\u5668\u5b8c\u6210\u6b64\u529f\u80fd\u3002")},sortTreeData:function(e,t,a){var r=function(r){for(var o=[],n=0;n<e.length;n++)e[n][a]!=e[n][t]&&e[n][a]==r[t]&&o.push(e[n]);return o},o=function(e){for(var t=r(e),a=0;a<t.length;a++)i.push(t[a]),o(t[a])},n=function(){for(var r={},o=e.length,n=0;o>n;n++){for(var i=1,l=0;o>l;l++)if(e[n][a]==e[l][t]){i=0;break}i&&(r[n]=e[n])}return r},i=[],l=n();return $.each(l,function(e,t){i.push(t),o(t)}),i},filterByInnerCode:function(e,t,a){var r=[];if(t&&t.length>0){var o=[];for(var n in t)t[n].innerCode.indexOf(a)>-1&&o.push(t[n]);if(e&&e.length>0)for(var n in e)for(var i in o)if(e[n].branchCode==o[i].branchCode){r.push(e[n]);break}}return r}};module.exports=Biz}),define("cl-commonjs/dist/1.1.3/bizcache",["$","$indexeddb","jslet-data","common"],function(e,t,a){var r=e("$");e("$indexeddb");var o=e("jslet-data"),n=e("common").utils,i=function(){function e(e,a,r,o){for(var n,i,l,d=a.length,s=e.length,c=t.openDB().objectStore("cachedbo"),u=0;d>u;u++)!function(t){i=a[t],l=!1;for(var r=0;s>r;r++)if(n=e[r],i.boCode==n.boCode){n.version!=i.version?(n.productCode=i.productCode,n.version=i.version,n.records=i.records,c.put(n).done(function(){console.log("\u7248\u672c\u53f7\u4e0d\u540c",t,d),t===d-1&&o&&o.call()}).fail(function(e){console.error(e)})):(console.log("\u7248\u672c\u53f7\u76f8\u540c",t,d),t===d-1&&o&&o.call()),l=!0;break}if(!l){var u={productCode:i.productCode,boCode:i.boCode,version:i.version,updateAlone:i.updateAlone,records:i.records};c.add(u).done(function(){t===d-1&&o&&o.call()}).fail(function(e){console.error(e)})}}(u);for(var f=0;s>f;f++){n=e[f],l=!1;for(var u=0;d>u;u++)i=a[u],i.boCode==n.boCode&&(l=!0);l||c["delete"](n.boCode).fail(function(e){console.error(e)})}}var t=this,a=[{name:"productCode",type:"S",length:30},{name:"boCode",type:"S",length:50},{name:"verson",type:"N",length:10},{name:"updateAlone",type:"N",length:30}],i=o.data.createDataset("cachedbo",a,{keyField:"boCode"});this.openDB=function(){var e=n.getUser(),t="cl-"+e.tenantId+"-"+(e.userCode||0);return r.indexedDB(t,{schema:{2:function(e){e.createObjectStore("tempdb",{keyPath:"boCode"}),e.createObjectStore("cachedbo",{keyPath:"boCode"}),e.createObjectStore("cachedbometa",{keyPath:"boCode"})}}})},this.saveSnapshot=function(e){newRec=e.exportSnapshot();var t=this.openDB().objectStore("tempdb");t.put({boCode:e.name(),dataset:newRec})},this.restoreSnapshot=function(e){var t=r.Deferred(),a=this.openDB().objectStore("tempdb");return a.get(e.name()).done(function(a){a&&(e.importSnapshot(a.dataset),t.resolve())}).fail(function(e){t.reject(e)}),t.promise()},this.deleteSnapshot=function(e){var t=this.openDB().objectStore("tempdb");t.delete(e.name())},this.refresh=function(t,a,r){var l=n.getUser().productCode;o.Checker.test("Bizcache.refresh#productCode",l).required().isString();var d,s=[],c=this.openDB().objectStore("cachedbo");d=t?c.clear():c.each(function(e){var t=e.value;t.productCode?s.push({productCode:t.productCode,boCode:t.boCode,version:t.version,updateAlone:t.updateAlone}):c.delete(e.key)}),d.done(function(){i.dataList(s),i.filter('[productCode] == "'+l+'" || [productCode] == "PAAS" || ![productCode]'),i.filtered(!0),i.selectAll(!0),i.submitSelected("../../../cl-restapi/cache/refresh.do").done(function(t){var o=t.main||[];e(s,o,a,r)})}).fail(function(e){alert("indexedDB \u65e0\u6cd5\u6253\u5f00!"),top.location.replace("../../../paas/view/login/login.html"),console.error(e)})},this.refreshAll=function(){this.refresh(!0,!0)},this.queryData=function(e){var t=r.Deferred(),a=this.openDB().objectStore("cachedbo");return a.get(e).done(function(e){t.resolve(e?e.records:null)}).fail(function(e){t.reject(e)}),t.promise()},this.queryMeta=function(e){var t=r.Deferred();return this.queryData("bo_bizobjectmeta").done(function(a){if(!a)return void t.reject("\u67e5\u4e0d\u5230\u6570\u636e\u96c6\u914d\u7f6e\u4fe1\u606f\uff01");for(var r=null,o=null,n=0,i=a.length;i>n;n++)if(r=a[n],e==r.boCode){o=r;break}t.resolve(o)}).fail(function(e){t.reject(e)}),t.promise()},this.queryAllMeta=function(){var e=r.Deferred();return this.queryData("bo_bizobjectmeta").done(function(t){return t?void e.resolve(t):void e.reject("\u67e5\u4e0d\u5230\u6570\u636e\u96c6\u914d\u7f6e\u4fe1\u606f\uff01")}).fail(function(t){e.reject(t)}),e.promise()},this.deleteDB=function(e,t){var a=r.indexedDB(e).deleteDatabase();a.done(function(){console.log(e+"\u5220\u9664\u6210\u529f"),t&&t(!0)}),a.fail(function(){console.log(e+"\u5220\u9664\u5931\u8d25"),t&&t(!1)}),a.progress(function(){console.log(e+"\u5220\u9664\u4e2d")})}};a.exports=new i}),define("cl-commonjs/dist/1.1.3/datasetfactory",["jslet-data","$","$indexeddb","common"],function(e){function t(e){function t(t){a[t]=e[t]||e[t.toLowerCase()]}var a={};return t("keyField"),t("codeField"),t("nameField"),t("parentField"),t("selectField"),t("recordClass"),t("queryUrl"),t("submitUrl"),t("pageNo"),t("pageSize"),t("fixedIndexFields"),t("indexFields"),t("filter"),t("filtered"),t("autoShowError"),t("autoRefreshHostDataset"),t("readOnly"),t("logChanged"),t("datasetListener"),t("onFieldChange"),t("onCheckSelectable"),t("contextRules"),a}function a(e,t,a,r){if(e&&0!==e.length)for(var o,n,i=0,l=e.length;l>i;i++)o=e[i],n=o.fieldCode,o.name=n,o.label=o.fieldName,o.displayName&&(o.label=o.displayName),o.type=o.dataType,o.tip=o.displayTip,o.unique=o.uniqued,o.subDataset=o.detailBoCode,t&&(o.visible=n==a||n==r)}var r,o=e("jslet-data"),n=e("cl-commonjs/dist/1.1.3/bizcache"),i={},l={};o.data.onCreatingDataset=function(e,t,a,r){if(r){var n=l.maxLevel;if(t==o.data.DatasetType.DETAIL)l[e]=0;else{if(hostLevel=l[r],hostLevel===n)return;l[e]=hostLevel+1}}else l[e]=0;var i=t==o.data.DatasetType.LOOKUP,d=o.data.getDataset(e);d||u(e,i,i,a)},i.onAllDatasetCreated=null,i.onDatasetLoaded=null;var d=!1,s=null;i.createDataset=function(e,t,a){function c(){(void 0===t||null===t)&&(t=1),r=[],l={maxLevel:t};var n;if(o.isArray(e))for(var d=0,s=e.length;s>d;d++)n=e[d],l[n]=0,u(n,a);else n=e,l[n]=0,u(n,a);var c=window.setInterval(function(){for(var e,t=r.length-1;t>=0;t--)e=r[t],o.data.getDataset(e)&&r.splice(t,1);0===r.length&&(window.clearInterval(c),c=null,i.onAllDatasetCreated&&i.onAllDatasetCreated())},10)}e&&(d?c():n.queryAllMeta().done(function(e){s=e,d=!0,c()}).fail(function(e){throw new Error(e)}))};var c=function(e){for(var t,a=0,r=s.length;r>a;a++)if(t=s[a],t.boCode==e)return t;throw new Error("\u627e\u4e0d\u5230["+e+"]\u6570\u636e\u96c6\u914d\u7f6e\uff0c\u8bf7\u68c0\u67e5\uff01")},u=function(e,d,s,u){if(console.info("\u6b63\u5728\u521b\u5efa\u6570\u636e\u96c6\uff1a"+e+"->"+u),u||(u=e),r){r.push(e);var f=c(u),h=null;!s&&f.queryFields&&f.queryFields.length>0&&(h=e+"_criteria",r.push(h),l[h]=l[e]);var p=t(f);a(f.fields,s,p.codeField,p.nameField),p.autoRefreshHostDataset=!0;var v=o.data.createDataset(e,f.fields,p);s&&v.disableContextRule(),h&&(a(f.queryFields),r.push(h),p.contextRules=f.queryContextRules,o.data.createDataset(h,f.queryFields,p)),d&&n.queryData(u).done(function(t){t?v.dataList(t):(v.queryUrl("/cl-restapi/dynamicentity/query.do"),v.query({bocode:u})),i.onDatasetLoaded&&i.onDatasetLoaded(e)})}};return i}),define("cl-commonjs/dist/1.1.3/userpref",["$","common","jslet-data"],function(e,t,a){var r=(e("$"),e("common").utils,e("jslet-data")),o=function(){var e=[{name:"menuId",type:"N"},{name:"prefType",type:"N",defaultValue:0},{name:"prefItemCode",type:"S",length:30},{name:"settings",type:"S",length:8e3}],t=r.data.createDataset("userPref",e,{autoShowError:!1});t.recordClass("com.chenlai.cloud.paas.ui.userpref.entity.UserPref"),t.queryUrl("/cl-restapi/userpref/query.do"),t.submitUrl("/cl-restapi/userpref/save.do");var a=!1,o=null;this.disabled=function(e){return void 0===e?a:(a=e,this)},this.loaded=!1,this.queryDatasetPref=function(){if(!a){var e=this._getMenuId();if(e){r.Checker.test("queryDatasetPref#menuId",e).required();var n=this;return t.query({menuId:e}).done(function(){if(n.loaded=!0,o)for(var e=0,t=o.length;t>e;e++)n._updateDatasetPref(o[e]);o=null})}}},this.saveDatasetPref=function(e,o,n){function i(t,a,r){for(var o,n=null,i=d.fields,l=0,s=i.length;s>l;l++)if(o=i[l],o.name==t){n=o;break}n||(n={name:t},i.push(n)),r||(r=e.getField(t)),n[a]=r[a]()}if(!a){var l=this._getMenuId();if(l){r.Checker.test("saveDatasetPref#menuId",l).required().isNumber(),r.Checker.test("saveDatasetPref#dataset",e).required(),r.Checker.test("saveDatasetPref#metaName",n).required().isString(),"displayOrder"!=n&&r.Checker.test("saveDatasetPref#fldName",o).required().isString();var d,s=e.name();if(t.findByField("prefItemCode",s)?(d=t.getFieldValue("settings"),d=d?r.JSON.parse(d):{name:s,fields:[]}):(t.appendRecord(),t.setFieldValue("menuId",l),t.setFieldValue("prefItemCode",s),d={name:s,fields:[]}),"displayOrder"!=n)i(o,n);else for(var c=e.getNormalFields(),u=0,f=c.length;f>u;u++)fldObj=c[u],fldObj.visible()&&i(fldObj.name(),n,fldObj);t.setFieldValue("settings",r.JSON.stringify(d)),t.confirm(),this._innerSave()}}},this._innerSave=r.debounce(function(){t.hasChangedData()&&t.submit()},500),this.deleteDatasetPref=function(e){if(e){var a=e.name();t.findByField("prefItemCode",a)&&t.deleteRecord()}else t.selectAll(!0),t.deleteSelected();t.hasChangedData()&&t.submit()},this._addPendingDataset=function(e){o||(o=[]),o.push(e)},this._updateDatasetPref=function(e){r.Checker.test("_updateDatasetPref#dsName",e).required().isString(),t.iterate(function(){function a(e,t,a){var r=e[a];(r||0===r)&&t[a](r)}if(!t.getFieldValue("prefType")){var o=t.getFieldValue("prefItemCode");if(e==o){var n=null;try{n=r.JSON.parse(t.getFieldValue("settings"))}catch(i){console.error(i)}if(n){for(var l,d,s,c=r.data.getDataset(e),u=n.fields,f=0,h=u.length;h>f;f++)l=u[f],d=l.name,s=c.getField(d),s&&(a(l,s,"displayOrder"),a(l,s,"displayWidth"),a(l,s,"visible"),a(l,s,"tabIndex"),a(l,s,"valueFollow"),a(l,s,"disable"),a(l,s,"readOnly"),a(l,s,"defaultValue"));c.refreshDisplayOrder();var p=r.data.RefreshEvent.changeMetaEvent("displayOrder",null);c.refreshControl(p)}}}})},this._getMenuId=function(){if(top.globalModule&&top.globalModule.tabNav){var e=top.globalModule.tabNav.getActivedItem();if(e){var t=parseInt(e.get("id"));return 0/0!==t?t:null}}return null}},n=new o;n.queryDatasetPref(),r.data.globalDataHandler.fieldMetaChanged(function(e,t,a){n.saveDatasetPref(e,t,a)}),r.data.globalDataHandler.datasetCreated(function(e){var t=e.name();n.loaded?n._updateDatasetPref(t):n._addPendingDataset(t)}),a.exports=n});