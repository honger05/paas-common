/* 2013-04-11 */
define("gallery/plupload/1.5.6/plupload",[],function(){return plupload}),function(){function e(){this.returnValue=!1}function t(){this.cancelBubble=!0}var n,i,r=0,a=[],o={},s={},l={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},d=/[<>&\"\']/g,u=window.setTimeout,c={};(function(e){var t,n,i,r=e.split(/,/);for(t=0;r.length>t;t+=2)for(i=r[t+1].split(/ /),n=0;i.length>n;n++)s[i[n]]=r[t]})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");var f={VERSION:"1.5.6",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:s,ua:function(){var e,t,n,i=navigator,r=i.userAgent,a=i.vendor;return e=/WebKit/.test(r),n=e&&-1!==a.indexOf("Apple"),t=window.opera&&window.opera.buildNumber,{windows:-1!==navigator.platform.indexOf("Win"),android:/Android/.test(r),ie:!e&&!t&&/MSIE/gi.test(r)&&/Explorer/gi.test(i.appName),webkit:e,gecko:!e&&/Gecko/.test(r),safari:n,opera:!!t}}(),typeOf:function(e){return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(e){return f.each(arguments,function(t,n){n>0&&f.each(t,function(t,n){e[n]=t})}),e},cleanName:function(e){var t,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;n.length>t;t+=2)e=e.replace(n[t],n[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(e,t){return t.name=e,a[e]=t,a.push(t),t},guid:function(){var e,t=(new Date).getTime().toString(32);for(e=0;5>e;e++)t+=Math.floor(65535*Math.random()).toString(32);return(f.guidPrefix||"p")+t+(r++).toString(32)},buildUrl:function(e,t){var n="";return f.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e},each:function(e,t){var i,r,a;if(e)if(i=e.length,i===n){for(r in e)if(e.hasOwnProperty(r)&&t(e[r],r)===!1)return}else for(a=0;i>a;a++)if(t(e[a],a)===!1)return},formatSize:function(e){return e===n||/\D/.test(e)?f.translate("N/A"):e>1073741824?Math.round(e/1073741824,1)+" GB":e>1048576?Math.round(e/1048576,1)+" MB":e>1024?Math.round(e/1024,1)+" KB":e+" b"},getPos:function(e,t){function n(e){var t,n,i=0,r=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===l.compatMode?l.documentElement:l.body,i=n.left+t.scrollLeft,r=n.top+t.scrollTop),{x:i,y:r}}var i,r,a,o=0,s=0,l=document;if(e=e,t=t||l.body,e&&e.getBoundingClientRect&&f.ua.ie&&(!l.documentMode||8>l.documentMode))return r=n(e),a=n(t),{x:r.x-a.x,y:r.y-a.y};for(i=e;i&&i!=t&&i.nodeType;)o+=i.offsetLeft||0,s+=i.offsetTop||0,i=i.offsetParent;for(i=e.parentNode;i&&i!=t&&i.nodeType;)o-=i.scrollLeft||0,s-=i.scrollTop||0,i=i.parentNode;return{x:o,y:s}},getSize:function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}},parseSize:function(e){var t;return"string"==typeof e&&(e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),t=e[2],e=+e[1],"g"==t&&(e*=1073741824),"m"==t&&(e*=1048576),"k"==t&&(e*=1024)),e},xmlEncode:function(e){return e?(""+e).replace(d,function(e){return l[e]?"&"+l[e]+";":e}):e},toArray:function(e){var t,n=[];for(t=0;e.length>t;t++)n[t]=e[t];return n},inArray:function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n}return-1},addI18n:function(e){return f.extend(o,e)},translate:function(e){return o[e]||e},isEmptyObj:function(e){if(e===n)return!0;for(var t in e)return!1;return!0},hasClass:function(e,t){var n;return""==e.className?!1:(n=RegExp("(^|\\s+)"+t+"(\\s+|$)"),n.test(e.className))},addClass:function(e,t){f.hasClass(e,t)||(e.className=""==e.className?t:e.className.replace(/\s+$/,"")+" "+t)},removeClass:function(e,t){var n=RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})},getStyle:function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},addEvent:function(r,a,o){var s,l,d;d=arguments[3],a=a.toLowerCase(),i===n&&(i="Plupload_"+f.guid()),r.addEventListener?(s=o,r.addEventListener(a,s,!1)):r.attachEvent&&(s=function(){var n=window.event;n.target||(n.target=n.srcElement),n.preventDefault=e,n.stopPropagation=t,o(n)},r.attachEvent("on"+a,s)),r[i]===n&&(r[i]=f.guid()),c.hasOwnProperty(r[i])||(c[r[i]]={}),l=c[r[i]],l.hasOwnProperty(a)||(l[a]=[]),l[a].push({func:s,orig:o,key:d})},removeEvent:function(e,t){var r,a,o;if("function"==typeof arguments[2]?a=arguments[2]:o=arguments[2],t=t.toLowerCase(),e[i]&&c[e[i]]&&c[e[i]][t]){r=c[e[i]][t];for(var s=r.length-1;s>=0&&(r[s].key!==o&&r[s].orig!==a||(e.removeEventListener?e.removeEventListener(t,r[s].func,!1):e.detachEvent&&e.detachEvent("on"+t,r[s].func),r[s].orig=null,r[s].func=null,r.splice(s,1),a===n));s--);if(r.length||delete c[e[i]][t],f.isEmptyObj(c[e[i]])){delete c[e[i]];try{delete e[i]}catch(l){e[i]=n}}}},removeAllEvents:function(e){var t=arguments[1];e[i]!==n&&e[i]&&f.each(c[e[i]],function(n,i){f.removeEvent(e,i,t)})}};f.Uploader=function(e){function t(){var e,t,n=0;if(this.state==f.STARTED){for(t=0;l.length>t;t++)e||l[t].status!=f.QUEUED?n++:(e=l[t],e.status=f.UPLOADING,this.trigger("BeforeUpload",e)&&this.trigger("UploadFile",e));n==l.length&&(this.stop(),this.trigger("UploadComplete",l))}}function i(){var e,t;for(r.reset(),e=0;l.length>e;e++)t=l[e],t.size!==n?(r.size+=t.size,r.loaded+=t.loaded):r.size=n,t.status==f.DONE?r.uploaded++:t.status==f.FAILED?r.failed++:r.queued++;r.size===n?r.percent=l.length>0?Math.ceil(100*(r.uploaded/l.length)):0:(r.bytesPerSec=Math.ceil(r.loaded/((+new Date-o||1)/1e3)),r.percent=r.size>0?Math.ceil(100*(r.loaded/r.size)):0)}var r,o,s={},l=[],d=!1;r=new f.QueueProgress,e=f.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},e),f.extend(this,{state:f.STOPPED,runtime:"",features:{},files:l,settings:e,total:r,id:f.guid(),init:function(){function r(){var e,t,n,i=d[p++];if(i){if(e=i.getFeatures(),t=g.settings.required_features)for(t=t.split(","),n=0;t.length>n;n++)if(!e[t[n]])return r(),void 0;i.init(g,function(t){t&&t.success?(g.features=e,g.runtime=i.name,g.trigger("Init",{runtime:i.name}),g.trigger("PostInit"),g.refresh()):r()})}else g.trigger("Error",{code:f.INIT_ERROR,message:f.translate("Init error.")})}var s,d,c,g=this,p=0;if("function"==typeof e.preinit?e.preinit(g):f.each(e.preinit,function(e,t){g.bind(t,e)}),e.page_url=e.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/"),/^(\w+:\/\/|\/)/.test(e.url)||(e.url=e.page_url+e.url),e.chunk_size=f.parseSize(e.chunk_size),e.max_file_size=f.parseSize(e.max_file_size),g.bind("FilesAdded",function(t,i){var r,a,o,s=0,d=e.filters;for(d&&d.length&&(o=[],f.each(d,function(e){f.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?o.push("\\.*"):o.push("\\."+e.replace(RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),o=RegExp(o.join("|")+"$","i")),r=0;i.length>r;r++)a=i[r],a.loaded=0,a.percent=0,a.status=f.QUEUED,!o||o.test(a.name)?a.size!==n&&a.size>e.max_file_size?t.trigger("Error",{code:f.FILE_SIZE_ERROR,message:f.translate("文件大小错误"),file:a}):(l.push(a),s++):t.trigger("Error",{code:f.FILE_EXTENSION_ERROR,message:f.translate("文件格式错误"),file:a});return s?(u(function(){g.trigger("QueueChanged"),g.refresh()},1),void 0):!1}),e.unique_names&&g.bind("UploadFile",function(e,t){var n=t.name.match(/\.([^.]+)$/),i="tmp";n&&(i=n[1]),t.target_name=t.id+"."+i}),g.bind("UploadProgress",function(e,t){t.percent=t.size>0?Math.ceil(100*(t.loaded/t.size)):100,i()}),g.bind("StateChanged",function(e){if(e.state==f.STARTED)o=+new Date;else if(e.state==f.STOPPED)for(s=e.files.length-1;s>=0;s--)e.files[s].status==f.UPLOADING&&(e.files[s].status=f.QUEUED,i())}),g.bind("QueueChanged",i),g.bind("Error",function(e,n){n.file&&(n.file.status=f.FAILED,i(),e.state==f.STARTED&&u(function(){t.call(g)},1))}),g.bind("FileUploaded",function(e,n){n.status=f.DONE,n.loaded=n.size,e.trigger("UploadProgress",n),u(function(){t.call(g)},1)}),e.runtimes)for(d=[],c=e.runtimes.split(/\s?,\s?/),s=0;c.length>s;s++)a[c[s]]&&d.push(a[c[s]]);else d=a;r(),"function"==typeof e.init?e.init(g):f.each(e.init,function(e,t){g.bind(t,e)})},refresh:function(){this.trigger("Refresh")},start:function(){l.length&&this.state!=f.STARTED&&(this.state=f.STARTED,this.trigger("StateChanged"),t.call(this))},stop:function(){this.state!=f.STOPPED&&(this.state=f.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},disableBrowse:function(){d=arguments[0]!==n?arguments[0]:!0,this.trigger("DisableBrowse",d)},getFile:function(e){var t;for(t=l.length-1;t>=0;t--)if(l[t].id===e)return l[t]},removeFile:function(e){var t;for(t=l.length-1;t>=0;t--)if(l[t].id===e.id)return this.splice(t,1)[0]},splice:function(e,t){var i;return i=l.splice(e===n?0:e,t===n?l.length:t),this.trigger("FilesRemoved",i),this.trigger("QueueChanged"),i},trigger:function(e){var t,n,i=s[e.toLowerCase()];if(i)for(n=Array.prototype.slice.call(arguments),n[0]=this,t=0;i.length>t;t++)if(i[t].func.apply(i[t].scope,n)===!1)return!1;return!0},hasEventListener:function(e){return!!s[e.toLowerCase()]},bind:function(e,t,n){var i;e=e.toLowerCase(),i=s[e]||[],i.push({func:t,scope:n||this}),s[e]=i},unbind:function(e){e=e.toLowerCase();var t,i=s[e],r=arguments[1];if(i){if(r!==n){for(t=i.length-1;t>=0;t--)if(i[t].func===r){i.splice(t,1);break}}else i=[];i.length||delete s[e]}},unbindAll:function(){var e=this;f.each(s,function(t,n){e.unbind(n)})},destroy:function(){this.stop(),this.trigger("Destroy"),this.unbindAll()}})},f.File=function(e,t,n){var i=this;i.id=e,i.name=t,i.size=n,i.loaded=0,i.percent=0,i.status=0},f.Runtime=function(){this.getFeatures=function(){},this.init=function(){}},f.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},f.runtimes={},window.plupload=f}(),function(e,t,n){function i(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}var r={},a={};n.flash={trigger:function(e,t,n){setTimeout(function(){var i=r[e];i&&i.trigger("Flash:"+t,n)},0)}},n.runtimes.Flash=n.addRuntime("flash",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,maxWidth:8091,maxHeight:8091,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(e,o){function s(){return t.getElementById(e.id+"_flash")}function l(){return c++>5e3?(o({success:!1}),void 0):(a[e.id]===!1&&setTimeout(l,1),void 0)}var d,u,c=0,f=t.body;return 10>i()?(o({success:!1}),void 0):(a[e.id]=!1,r[e.id]=e,d=t.getElementById(e.settings.browse_button),u=t.createElement("div"),u.id=e.id+"_flash_container",n.extend(u.style,{position:"absolute",top:"0px",background:e.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"}),u.className="plupload flash",e.settings.container&&(f=t.getElementById(e.settings.container),"static"===n.getStyle(f,"position")&&(f.style.position="relative")),f.appendChild(u),function(){var i,r;i='<object id="'+e.id+'_flash" type="application/x-shockwave-flash" data="'+e.settings.flash_swf_url+'" ',n.ua.ie&&(i+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),i+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+e.settings.flash_swf_url+'" /><param name="flashvars" value="id='+escape(e.id)+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',n.ua.ie?(r=t.createElement("div"),u.appendChild(r),r.outerHTML=i,r=null):u.innerHTML=i}(),l(),d=u=null,e.bind("Destroy",function(e){var i;n.removeAllEvents(t.body,e.id),delete a[e.id],delete r[e.id],i=t.getElementById(e.id+"_flash_container"),i&&i.parentNode.removeChild(i)}),e.bind("Flash:Init",function(){var i={};try{s().setFileFilters(e.settings.filters,e.settings.multi_selection)}catch(r){return o({success:!1}),void 0}a[e.id]||(a[e.id]=!0,e.bind("UploadFile",function(t,r){var a=t.settings,o=e.settings.resize||{};s().uploadFile(i[r.id],a.url,{name:r.target_name||r.name,mime:n.mimeTypes[r.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:a.chunk_size,width:o.width,height:o.height,quality:o.quality,multipart:a.multipart,multipart_params:a.multipart_params||{},file_data_name:a.file_data_name,format:/\.(jpg|jpeg)$/i.test(r.name)?"jpg":"png",headers:a.headers,urlstream_upload:a.urlstream_upload})}),e.bind("CancelUpload",function(){s().cancelUpload()}),e.bind("Flash:UploadProcess",function(e,t){var r=e.getFile(i[t.id]);r.status!=n.FAILED&&(r.loaded=t.loaded,r.size=t.size,e.trigger("UploadProgress",r))}),e.bind("Flash:UploadChunkComplete",function(e,t){var r,a=e.getFile(i[t.id]);r={chunk:t.chunk,chunks:t.chunks,response:t.text},e.trigger("ChunkUploaded",a,r),a.status!==n.FAILED&&e.state!==n.STOPPED&&s().uploadNextChunk(),t.chunk==t.chunks-1&&(a.status=n.DONE,e.trigger("FileUploaded",a,{response:t.text}))}),e.bind("Flash:SelectFiles",function(t,r){var a,o,s,l=[];for(o=0;r.length>o;o++)a=r[o],s=n.guid(),i[s]=a.id,i[a.id]=s,l.push(new n.File(s,a.name,a.size));l.length&&e.trigger("FilesAdded",l)}),e.bind("Flash:SecurityError",function(t,r){e.trigger("Error",{code:n.SECURITY_ERROR,message:n.translate("Security error."),details:r.message,file:e.getFile(i[r.id])})}),e.bind("Flash:GenericError",function(t,r){e.trigger("Error",{code:n.GENERIC_ERROR,message:n.translate("Generic error."),details:r.message,file:e.getFile(i[r.id])})}),e.bind("Flash:IOError",function(t,r){e.trigger("Error",{code:n.IO_ERROR,message:n.translate("IO error."),details:r.message,file:e.getFile(i[r.id])})}),e.bind("Flash:ImageError",function(t,r){e.trigger("Error",{code:parseInt(r.code,10),message:n.translate("Image error."),file:e.getFile(i[r.id])})}),e.bind("Flash:StageEvent:rollOver",function(i){var r,a;r=t.getElementById(e.settings.browse_button),a=i.settings.browse_button_hover,r&&a&&n.addClass(r,a)}),e.bind("Flash:StageEvent:rollOut",function(i){var r,a;r=t.getElementById(e.settings.browse_button),a=i.settings.browse_button_hover,r&&a&&n.removeClass(r,a)}),e.bind("Flash:StageEvent:mouseDown",function(i){var r,a;r=t.getElementById(e.settings.browse_button),a=i.settings.browse_button_active,r&&a&&(n.addClass(r,a),n.addEvent(t.body,"mouseup",function(){n.removeClass(r,a)},i.id))}),e.bind("Flash:StageEvent:mouseUp",function(i){var r,a;r=t.getElementById(e.settings.browse_button),a=i.settings.browse_button_active,r&&a&&n.removeClass(r,a)}),e.bind("Flash:ExifData",function(t,n){e.trigger("ExifData",e.getFile(i[n.id]),n.data)}),e.bind("Flash:GpsData",function(t,n){e.trigger("GpsData",e.getFile(i[n.id]),n.data)}),e.bind("QueueChanged",function(){e.refresh()}),e.bind("FilesRemoved",function(e,t){var n;for(n=0;t.length>n;n++)s().removeFile(i[t[n].id])}),e.bind("StateChanged",function(){e.refresh()}),e.bind("Refresh",function(i){var r,a,o;s().setFileFilters(e.settings.filters,e.settings.multi_selection),r=t.getElementById(i.settings.browse_button),r&&(a=n.getPos(r,t.getElementById(i.settings.container)),o=n.getSize(r),n.extend(t.getElementById(i.id+"_flash_container").style,{top:a.y+"px",left:a.x+"px",width:o.w+"px",height:o.h+"px"}))}),e.bind("DisableBrowse",function(e,t){s().disableBrowse(t)}),o({success:!0}))}),void 0)}})}(window,document,plupload),function(e,t,n,r){function a(t,n){var i;return"FileReader"in e?(i=new FileReader,i.readAsDataURL(t),i.onload=function(){n(i.result)},void 0):n(t.getAsDataURL())}function o(t,n){var i;return"FileReader"in e?(i=new FileReader,i.readAsBinaryString(t),i.onload=function(){n(i.result)},void 0):n(t.getAsBinary())}function s(e,n,i,r){var o,s,l,c,g=this;a(f[e.id],function(a){o=t.createElement("canvas"),o.style.display="none",t.body.appendChild(o),s=o.getContext("2d"),l=new Image,l.onerror=l.onabort=function(){r({success:!1})},l.onload=function(){var t,f,p,h;if(n.width||(n.width=l.width),n.height||(n.height=l.height),c=Math.min(n.width/l.width,n.height/l.height),1>c)t=Math.round(l.width*c),f=Math.round(l.height*c);else{if(!n.quality||"image/jpeg"!==i)return r({success:!1}),void 0;t=l.width,f=l.height}if(o.width=t,o.height=f,s.drawImage(l,0,0,t,f),"image/jpeg"===i&&(p=new d(atob(a.substring(a.indexOf("base64,")+7))),p.headers&&p.headers.length&&(h=new u,h.init(p.get("exif")[0])&&(h.setExif("PixelXDimension",t),h.setExif("PixelYDimension",f),p.set("exif",h.getBinary()),g.hasEventListener("ExifData")&&g.trigger("ExifData",e,h.EXIF()),g.hasEventListener("GpsData")&&g.trigger("GpsData",e,h.GPS())))),n.quality&&"image/jpeg"===i)try{a=o.toDataURL(i,n.quality/100)}catch(m){a=o.toDataURL(i)}else a=o.toDataURL(i);a=a.substring(a.indexOf("base64,")+7),a=atob(a),p&&p.headers&&p.headers.length&&(a=p.restore(a),p.purge()),o.parentNode.removeChild(o),r({success:!0,data:a})},l.src=a})}function l(){function e(e,t){var n,r=a?0:-8*(t-1),o=0;for(n=0;t>n;n++)o|=i.charCodeAt(e+n)<<Math.abs(r+8*n);return o}function t(e,t,n){var n=3===arguments.length?n:i.length-t-1;i=i.substr(0,t)+e+i.substr(n+t)}function n(e,n,i){var r,o="",s=a?0:-8*(i-1);for(r=0;i>r;r++)o+=String.fromCharCode(255&n>>Math.abs(s+8*r));t(o,e,i)}var i,a=!1;return{II:function(e){return e===r?a:(a=e,void 0)},init:function(e){a=!1,i=e},SEGMENT:function(e,n,r){switch(arguments.length){case 1:return i.substr(e,i.length-e-1);case 2:return i.substr(e,n);case 3:t(r,e,n);break;default:return i}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(t,i){return i===r?e(t,4):(n(t,i,4),void 0)},SLONG:function(t){var n=e(t,4);return n>2147483647?n-4294967296:n},STRING:function(t,n){var i="";for(n+=t;n>t;t++)i+=String.fromCharCode(e(t,1));return i}}}function d(e){var t,n,i,a={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},o=[],s=r,u=0;if(t=new l,t.init(e),65496===t.SHORT(0)){for(n=2,i=Math.min(1048576,e.length);i>=n;)if(s=t.SHORT(n),s>=65488&&65495>=s)n+=2;else{if(65498===s||65497===s)break;u=t.SHORT(n+2)+2,a[s]&&t.STRING(n+4,a[s].signature.length)===a[s].signature&&o.push({hex:s,app:a[s].app.toUpperCase(),name:a[s].name.toUpperCase(),start:n,length:u,segment:t.SEGMENT(n,u)}),n+=u}return t.init(null),{headers:o,restore:function(e){t.init(e);var i=new d(e);if(!i.headers)return!1;for(var r=i.headers.length;r>0;r--){var a=i.headers[r-1];t.SEGMENT(a.start,a.length,"")}i.purge(),n=65504==t.SHORT(2)?4+t.SHORT(4):2;for(var r=0,s=o.length;s>r;r++)t.SEGMENT(n,0,o[r].segment),n+=o[r].length;return t.SEGMENT()},get:function(e){for(var t=[],n=0,i=o.length;i>n;n++)o[n].app===e.toUpperCase()&&t.push(o[n].segment);return t},set:function(e,t){var n=[];"string"==typeof t?n.push(t):n=t;for(var i=ii=0,r=o.length;r>i&&(o[i].app===e.toUpperCase()&&(o[i].segment=n[ii],o[i].length=n[ii].length,ii++),!(ii>=n.length));i++);},purge:function(){o=[],t.init(null)}}}}function u(){function e(e,t){var n,i,a,s,l,c,f,g,p=o.SHORT(e),h=[],m={};for(n=0;p>n;n++)if(f=c=e+12*n+2,a=t[o.SHORT(f)],a!==r){switch(s=o.SHORT(f+=2),l=o.LONG(f+=2),f+=4,h=[],s){case 1:case 7:for(l>4&&(f=o.LONG(f)+u.tiffHeader),i=0;l>i;i++)h[i]=o.BYTE(f+i);break;case 2:l>4&&(f=o.LONG(f)+u.tiffHeader),m[a]=o.STRING(f,l-1);continue;case 3:for(l>2&&(f=o.LONG(f)+u.tiffHeader),i=0;l>i;i++)h[i]=o.SHORT(f+2*i);break;case 4:for(l>1&&(f=o.LONG(f)+u.tiffHeader),i=0;l>i;i++)h[i]=o.LONG(f+4*i);break;case 5:for(f=o.LONG(f)+u.tiffHeader,i=0;l>i;i++)h[i]=o.LONG(f+4*i)/o.LONG(f+4*i+4);break;case 9:for(f=o.LONG(f)+u.tiffHeader,i=0;l>i;i++)h[i]=o.SLONG(f+4*i);break;case 10:for(f=o.LONG(f)+u.tiffHeader,i=0;l>i;i++)h[i]=o.SLONG(f+4*i)/o.SLONG(f+4*i+4);break;default:continue}g=1==l?h[0]:h,m[a]=d.hasOwnProperty(a)&&"object"!=typeof g?d[a][g]:g}return m}function t(){var t=r,n=u.tiffHeader;return o.II(18761==o.SHORT(n)),42!==o.SHORT(n+=2)?!1:(u.IFD0=u.tiffHeader+o.LONG(n+=2),t=e(u.IFD0,s.tiff),u.exifIFD="ExifIFDPointer"in t?u.tiffHeader+t.ExifIFDPointer:r,u.gpsIFD="GPSInfoIFDPointer"in t?u.tiffHeader+t.GPSInfoIFDPointer:r,!0)}function a(e,t,n){var r,a,l,d=0;if("string"==typeof t){var c=s[e.toLowerCase()];for(hex in c)if(c[hex]===t){t=hex;break}}for(r=u[e.toLowerCase()+"IFD"],a=o.SHORT(r),i=0;a>i;i++)if(l=r+12*i+2,o.SHORT(l)==t){d=l+8;break}return d?(o.LONG(d,n),!0):!1}var o,s,d,u={};return o=new l,s={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},d={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return u={tiffHeader:10},e!==r&&e.length?(o.init(e),65505===o.SHORT(0)&&"EXIF\0"===o.STRING(4,5).toUpperCase()?t():!1):!1},EXIF:function(){var t;if(t=e(u.exifIFD,s.exif),t.ExifVersion&&"array"===n.typeOf(t.ExifVersion)){for(var i=0,r="";t.ExifVersion.length>i;i++)r+=String.fromCharCode(t.ExifVersion[i]);t.ExifVersion=r}return t},GPS:function(){var t;return t=e(u.gpsIFD,s.gps),t.GPSVersionID&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:a("exif",e,t)},getBinary:function(){return o.SEGMENT()}}}var c,f={};n.runtimes.Html5=n.addRuntime("html5",{getFeatures:function(){var i,r,a,o,s,l;return r=a=s=l=!1,e.XMLHttpRequest&&(i=new XMLHttpRequest,i.withCredentials = true,a=!!i.upload,r=!(!i.sendAsBinary&&!i.upload)),r&&(o=!!(i.sendAsBinary||e.Uint8Array&&e.ArrayBuffer),s=!(!File||!File.prototype.getAsDataURL&&!e.FileReader||!o),l=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),c=n.ua.safari&&n.ua.windows,{html5:r,dragdrop:function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e}(),jpgresize:s,pngresize:s,multipart:s||!!e.FileReader||!!e.FormData,canSendBinary:o,cantSendBlobInFormData:!(!(n.ua.gecko&&e.FormData&&e.FileReader)||FileReader.prototype.readAsArrayBuffer)||n.ua.android,progress:a,chunks:l,multi_selection:!(n.ua.safari&&n.ua.windows),triggerDialog:n.ua.gecko&&e.FormData||n.ua.webkit}},init:function(i,r){function a(e){var t,r,a,o=[],s={};for(r=0;e.length>r;r++)t=e[r],s[t.name]||(s[t.name]=!0,a=n.guid(),f[a]=t,o.push(new n.File(a,t.fileName||t.name,t.fileSize||t.size)));o.length&&i.trigger("FilesAdded",o)}var l,d;return l=this.getFeatures(),l.html5?(i.bind("Init",function(e){var r,o,s,l,d,u,c,f=[],g=e.settings.filters,p=t.body;r=t.createElement("div"),r.id=e.id+"_html5_container",n.extend(r.style,{position:"absolute",background:i.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:i.settings.shim_bgcolor?"":0}),r.className="plupload html5",i.settings.container&&(p=t.getElementById(i.settings.container),"static"===n.getStyle(p,"position")&&(p.style.position="relative")),p.appendChild(r);e:for(s=0;g.length>s;s++)for(d=g[s].extensions.split(/,/),l=0;d.length>l;l++){if("*"===d[l]){f=[];break e}u=n.mimeTypes[d[l]],u&&-1===n.inArray(u,f)&&f.push(u)}if(r.innerHTML='<input id="'+i.id+'_html5"  style="font-size:999px" type="file" accept="'+f.join(",")+'" '+(i.settings.multi_selection&&i.features.multi_selection?'multiple="multiple"':"")+" />",r.scrollTop=100,c=t.getElementById(i.id+"_html5"),e.features.triggerDialog?n.extend(c.style,{position:"absolute",width:"100%",height:"100%"}):n.extend(c.style,{cssFloat:"right",styleFloat:"right"}),c.onchange=function(){a(this.files),this.value=""},o=t.getElementById(e.settings.browse_button)){var h=e.settings.browse_button_hover,m=e.settings.browse_button_active,v=e.features.triggerDialog?o:r;h&&(n.addEvent(v,"mouseover",function(){n.addClass(o,h)},e.id),n.addEvent(v,"mouseout",function(){n.removeClass(o,h)},e.id)),m&&(n.addEvent(v,"mousedown",function(){n.addClass(o,m)},e.id),n.addEvent(t.body,"mouseup",function(){n.removeClass(o,m)},e.id)),e.features.triggerDialog&&n.addEvent(o,"click",function(n){var i=t.getElementById(e.id+"_html5");i&&!i.disabled&&i.click(),n.preventDefault()},e.id)}}),i.bind("PostInit",function(){var e=t.getElementById(i.settings.drop_element);if(e){if(c)return n.addEvent(e,"dragenter",function(){var r,o,s;r=t.getElementById(i.id+"_drop"),r||(r=t.createElement("input"),r.setAttribute("type","file"),r.setAttribute("id",i.id+"_drop"),r.setAttribute("multiple","multiple"),n.addEvent(r,"change",function(){a(this.files),n.removeEvent(r,"change",i.id),r.parentNode.removeChild(r)},i.id),n.addEvent(r,"dragover",function(e){e.stopPropagation()},i.id),e.appendChild(r)),o=n.getPos(e,t.getElementById(i.settings.container)),s=n.getSize(e),"static"===n.getStyle(e,"position")&&n.extend(e.style,{position:"relative"}),n.extend(r.style,{position:"absolute",display:"block",top:0,left:0,width:s.w+"px",height:s.h+"px",opacity:0})},i.id),void 0;n.addEvent(e,"dragover",function(e){e.preventDefault()},i.id),n.addEvent(e,"drop",function(e){var t=e.dataTransfer;t&&t.files&&a(t.files),e.preventDefault()},i.id)}}),i.bind("Refresh",function(e){var r,a,o,s,l;r=t.getElementById(i.settings.browse_button),r&&(a=n.getPos(r,t.getElementById(e.settings.container)),o=n.getSize(r),s=t.getElementById(i.id+"_html5_container"),n.extend(s.style,{top:a.y+"px",left:a.x+"px",width:o.w+"px",height:o.h+"px"}),i.features.triggerDialog&&("static"===n.getStyle(r,"position")&&n.extend(r.style,{position:"relative"}),l=parseInt(n.getStyle(r,"zIndex"),10),isNaN(l)&&(l=0),n.extend(r.style,{zIndex:l}),n.extend(s.style,{zIndex:l-1})))}),i.bind("DisableBrowse",function(e,n){var i=t.getElementById(e.id+"_html5");i&&(i.disabled=n)}),i.bind("CancelUpload",function(){d&&d.abort&&d.abort()}),i.bind("UploadFile",function(t,i){function r(e,t,n){var i;if(!File.prototype.slice)return(i=File.prototype.webkitSlice||File.prototype.mozSlice)?i.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(r){return e.slice(t,n-t)}}function a(a){function o(){function g(e){if(d.sendAsBinary)d.sendAsBinary(e);else if(t.features.canSendBinary){for(var n=new Uint8Array(e.length),i=0;e.length>i;i++)n[i]=255&e.charCodeAt(i);d.send(n.buffer)}}function p(r){var a,c=0,f="----pluploadboundary"+n.guid(),p="--",x="\r\n",w="";if(d=new XMLHttpRequest,d.withCredentials = true,d.upload&&(d.upload.onprogress=function(e){i.loaded=Math.min(i.size,u+e.loaded-c),t.trigger("UploadProgress",i)}),d.onreadystatechange=function(){var e,l;if(4==d.readyState&&t.state!==n.STOPPED){try{e=d.status}catch(c){e=0}if(e>=400)t.trigger("Error",{code:n.HTTP_ERROR,message:n.translate("HTTP Error."),file:i,status:e});else{if(m){if(l={chunk:s,chunks:m,response:d.responseText,status:e},t.trigger("ChunkUploaded",i,l),u+=y,l.cancelled)return i.status=n.FAILED,void 0;i.loaded=Math.min(i.size,(s+1)*E)}else i.loaded=i.size;t.trigger("UploadProgress",i),r=h=a=w=null,!m||++s>=m?(i.status=n.DONE,t.trigger("FileUploaded",i,{response:d.responseText,status:e})):o()}}},t.settings.multipart&&l.multipart){if(v.name=i.target_name||i.name,d.open("post",S,!0),n.each(t.settings.headers,function(e,t){d.setRequestHeader(t,e)}),"string"!=typeof r&&e.FormData)return a=new FormData,n.each(n.extend(v,t.settings.multipart_params),function(e,t){a.append(t,e)}),a.append(t.settings.file_data_name,r),d.send(a),void 0;if("string"==typeof r)return d.setRequestHeader("Content-Type","multipart/form-data; boundary="+f),n.each(n.extend(v,t.settings.multipart_params),function(e,t){w+=p+f+x+'Content-Disposition: form-data; name="'+t+'"'+x+x,w+=unescape(encodeURIComponent(e))+x}),b=n.mimeTypes[i.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",w+=p+f+x+'Content-Disposition: form-data; name="'+t.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(i.name))+'"'+x+"Content-Type: "+b+x+x+r+x+p+f+p+x,c=w.length-r.length,r=w,g(r),void 0}S=n.buildUrl(t.settings.url,n.extend(v,t.settings.multipart_params)),d.open("post",S,!0),d.setRequestHeader("Content-Type","application/octet-stream"),n.each(t.settings.headers,function(e,t){d.setRequestHeader(t,e)
}),"string"==typeof r?g(r):d.send(r)}var h,m,v,E,y,b,S=t.settings.url;i.status!=n.DONE&&i.status!=n.FAILED&&t.state!=n.STOPPED&&(v={name:i.target_name||i.name},c.chunk_size&&i.size>c.chunk_size&&(l.chunks||"string"==typeof a)?(E=c.chunk_size,m=Math.ceil(i.size/E),y=Math.min(E,i.size-s*E),h="string"==typeof a?a.substring(s*E,s*E+y):r(a,s*E,s*E+y),v.chunk=s,v.chunks=m):(y=i.size,h=a),t.settings.multipart&&l.multipart&&"string"!=typeof h&&f&&l.cantSendBlobInFormData&&l.chunks&&t.settings.chunk_size?(f.onload=function(){p(f.result)},f.readAsBinaryString(h)):p(h))}var s=0,u=0,f="FileReader"in e?new FileReader:null;o()}var u,c=t.settings;u=f[i.id],l.jpgresize&&t.settings.resize&&/\.(png|jpg|jpeg)$/i.test(i.name)?s.call(t,i,t.settings.resize,/\.png$/i.test(i.name)?"image/png":"image/jpeg",function(e){e.success?(i.size=e.data.length,a(e.data)):l.chunks?a(u):o(u,a)}):!l.chunks&&l.jpgresize?o(u,a):a(u)}),i.bind("Destroy",function(e){var i,r,a=t.body,o={inputContainer:e.id+"_html5_container",inputFile:e.id+"_html5",browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(i in o)r=t.getElementById(o[i]),r&&n.removeAllEvents(r,e.id);n.removeAllEvents(t.body,e.id),e.settings.container&&(a=t.getElementById(e.settings.container)),a.removeChild(t.getElementById(o.inputContainer))}),r({success:!0}),void 0):(r({success:!1}),void 0)}})}(window,document,plupload);